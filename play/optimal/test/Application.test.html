*{ You can use plain selenium command using the selenium tag }*


*{ GETTING FILE UPLOAD TESTING TO WORK. IN FIREFOX:

  about:config
  set the value of “signed.applets.codebase_principal_support” to “true”
  
  Add netscape.security.PrivilegeManager.enablePrivilege('UniversalFileRead');
  
  to Selenium.prototype.doType in the file selenium-api.js
}*


#{selenium}
    // Check that non-logged in authenticated pages lead to login page
    open('/authenticated/home')
    assertTitle('WhatsOutThere.co.uk')

    // Step through a few pages to check they're all working
    open('/')
    assertTextNotPresent( 'Logout' )
    assertTitle('WhatsOutThere.co.uk')
    clickAndWait( 'link=Help' )
    assertTextNotPresent( 'Logout' )
    assertTitle('Help')
    clickAndWait( 'link=About us' )
    assertTextNotPresent( 'Logout' )
    assertTitle( 'About us' )
    clickAndWait( 'link=Contact' )
    assertTextNotPresent( 'Logout' )
    assertTitle( 'Contact us' )
    clickAndWait( 'link=login' )
    assertTextNotPresent( 'Logout' )
    assertTitle( 'Login' )
    clickAndWait( 'link=register' )
    assertTextNotPresent( 'Logout' )
    assertTitle( 'Register' )
    
    // Register with the site
    clickAndWait( 'link=register' ) 
    type( 'name=email', 'alex_wilson@pobox.com' )
    type( 'name=username', 'Alex Wilson' )
    type( 'name=password1', 'imptrw' )
    type( 'name=password2', 'omptrw' )
    type( 'name=captcha', 'bloo' )
    clickAndWait( 'name=submit' )
    
    verifyTextPresent( 'Passwords do not match. Please try again' )
    
    type( 'name=password2', 'imptrw' )
    clickAndWait( 'name=submit' )
    
    // Should fail as captcha text does not match
    assertTitle( 'Register' )
    verifyTextPresent( 'Captcha text does not match' )
    
    type( 'name=captcha', 'cPPftsUp4TzZZdXyCmmpNpfT' )
    clickAndWait( 'name=submit' )
    verifyTextPresent( 'Thanks for registering Alex Wilson' )
    assertTitle( 'Home' )
    clickAndWait( 'link=Logout' )
    
    // Check that a second registration fails
    clickAndWait( 'link=register' )
    type( 'name=email', 'alex_wilson@pobox.com' )
    type( 'name=username', 'Alex Wilson' )
    type( 'name=password1', 'imptrw' )
    type( 'name=password2', 'imptrw' )
    type( 'name=captcha', 'cPPftsUp4TzZZdXyCmmpNpfT' )
    clickAndWait( 'name=submit' )
    
    verifyTextPresent( 'Email address already taken. Please try again' )
    
    // Check that a second registration fails
    clickAndWait( 'link=register' )
    type( 'name=email', 'gav@blah.com' )
    type( 'name=username', 'Gavin Lightfoot' )
    type( 'name=password1', 'bloo' )
    type( 'name=password2', 'bloo' )
    type( 'name=captcha', 'cPPftsUp4TzZZdXyCmmpNpfT' )
    clickAndWait( 'name=submit' )
    verifyTextPresent( 'Thanks for registering Gavin Lightfoot' )
    assertTitle( 'Home' )
    clickAndWait( 'link=Logout' )
    
    clickAndWait( 'link=login' )
    type( 'name=email', 'gav@blah.com' )
    type( 'name=password', 'bloo' )
    clickAndWait( 'name=submit' )
    verifyTextPresent( 'Welcome Gavin Lightfoot' )
    assertTitle( 'Home' )
    clickAndWait( 'link=Logout' )
    
    clickAndWait( 'link=login' )
    type( 'name=email', 'alex_wilson@pobox.com' )
    type( 'name=password', 'imptrw' )
    clickAndWait( 'name=submit' )
    verifyTextPresent( 'Welcome Alex Wilson' )
    assertTitle( 'Home' )
    
    clickAndWait( 'link=Logout' )
    assertTextNotPresent( 'Logout' )
    
    clickAndWait( 'link=login' )
    type( 'name=email', 'alex_wilson@pobox.com' )
    type( 'name=password', 'imptrw' )
    clickAndWait( 'name=submit' )
    
    // Test all the relevant links
    clickAndWait( 'link=Upload CV' )
    assertTitle( 'Upload CV' )
    clickAndWait( 'link=Add position' )
    assertTitle( 'Add position' )
    clickAndWait( 'link=Add search' )
    assertTitle( 'Add search' )
    clickAndWait( 'link=Manage CVs' )
    assertTitle( 'Manage CVs' )
    clickAndWait( 'link=Manage positions' )
    assertTitle( 'Manage positions' )
    clickAndWait( 'link=Manage searches' )
    assertTitle( 'Manage searches' )
    
    // Try a file upload
    clickAndWait( 'link=Upload CV' )
    assertTitle( 'Upload CV' )
    type( 'name=description', 'An example CV' )
    type( 'name=pdf', '/home/alex/Desktop/SoftwareCV0108.pdf' )
    
    setTimeout( 90000 )
    clickAndWait( 'name=submit' )
    
    waitForVisible( 'id=processing' )
    waitForNotVisible( 'id=processing' )
    assertTitle( 'Manage CVs' )
    assertTextPresent( 'An example CV' )
    
    
    clickAndWait( 'link=Add position' )
    
    type( 'name=companyName', 'Celoxica Ltd' )
    click( 'name=lookupCompany' )
    waitForVisible( 'id=companyDialog' )
    assertTextPresent( 'Company details' )
    click( 'id=selectButton' )
    waitForNotVisible( 'id=companyDialog' )
    type( 'name=companyUrl', 'www.celoxica.com' )
    type( 'name=companyDescription', 'FPGA-based financial algorithm acceleration' )
    type( 'name=department', 'Research and development' )
    type( 'name=jobTitle', 'Research and development manager' )
    type( 'name=startYear', '2000' )
    type( 'name=endYear', '2007' )
    type( 'name=address', '66 Milton Park, Abingdon, Oxfordshire' )
    click( 'name=lookupAddress' )
    waitForCondition("selenium.browserbot.getUserWindow().$('#loc').val() != \"\"", "5000");
    clickAndWait( 'name=submit' )
    
    wait for id='loc' to be non=empty
    
    assertTitle( 'Manage positions' )
    
    clickAndWait( 'link=Logout' )

#{/selenium}
